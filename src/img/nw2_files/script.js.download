"object"!==typeof DotmetricsJSON&&(DotmetricsJSON=window.JSON);(function(){function w(d){this.foundVideoPlayers=[];this.SearchForNewVideoPlayersInterval=5E3;this.newVideoFoundCallback=d;this.init=function(){this.trackVideos()};this.trackVideos=function(){function a(a){a.contentWindow&&c.searchForVideosInWindow(a.contentWindow)}this.searchForVideosInWindow(window);for(var b=window.document.getElementsByTagName("iframe"),c=this,d=0;d<b.length;d++)a(b[d]);c=this;setTimeout(function(){c.trackVideos()},this.SearchForNewVideoPlayersInterval)};this.searchForVideosInWindow=
function(a){try{a.jwplayer}catch(b){return}this.searchForFlowPlayerPlayersInWindow(a);this.searchForJWPlayerPlayersInWindow(a);this.searchForVideoJSPlayersInWindow(a)};this.searchForFlowPlayerPlayersInWindow=function(a){if(a.flowplayer){var b=[],c=0;if("undefined"!=typeof a.flowplayer.instances)for(a.flowplayer.instances.forEach(function(a){b.push(a)}),c=0;c<b.length;c++)0>this.foundVideoPlayers.indexOf(b[c])&&(this.foundVideoPlayers.push(b[c]),this.newVideoFoundCallback("flowPlayer",a.flowplayer.version,
b[c]))}};this.searchForJWPlayerPlayersInWindow=function(a){if(a.jwplayer){var b=[];for(c=0;a.jwplayer(c).id;)b.push(a.jwplayer(c)),c++;for(var c=0;c<b.length;c++){a=!0;for(var d=0;d<this.foundVideoPlayers.length;d++)this.foundVideoPlayers[d].id&&this.foundVideoPlayers[d].id==b[c].id&&(a=!1);a&&(this.foundVideoPlayers.push(b[c]),this.newVideoFoundCallback("jwPlayer",b[c].version,b[c]))}}};this.searchForVideoJSPlayersInWindow=function(a){if(a.videojs&&"object"==typeof a.videojs.players)for(videoId in a.videojs.players){var b=
a.videojs.players[videoId];0>this.foundVideoPlayers.indexOf(b)&&(this.foundVideoPlayers.push(b),this.newVideoFoundCallback("videojs",a.videojs.VERSION,b))}}}function y(){this.formPostCount=this.pingSendCount=this.dataSendCount=0;this.callLimit=10;this.isRegExp=function(d){return"[object RegExp]"==Object.prototype.toString.call(d)};this.setCookie=function(d,a,b,c){var h=new Date;h.setDate(h.getDate()+b);c&&h.setMinutes(h.getMinutes()+c);a=escape(a)+(null==b?"":"; expires="+h.toUTCString());document.cookie=
d+"="+a+";path=/;secure;"};this.getCookie=function(d){return this.hasCookie(d)?this.listCookie()[d+""]:null};this.hasCookie=function(d){return(new RegExp("(?:;\\s*|^)"+encodeURIComponent(d+"")+"=")).test(document.cookie)};this.lsAvailable=function(){try{var d=window.localStorage;d.setItem("__storage_test__","__storage_test__");d.removeItem("__storage_test__");return!0}catch(a){return!1}};this.listCookie=function(d){for(var a=document.cookie.split(";"),b,c={},h=0,g=a.length;h<g;++h)if(b=a[h].split("="),
b[0]=b[0].replace(/^\s+|\s+$/,""),!this.isRegExp(d)||d.test(b[0]))try{c[decodeURIComponent(b[0])]=decodeURIComponent(b[1])}catch(e){}return c};this.sendData=function(d,a){var b=window.DotMetricsSettings;switch(d){case b.DataUrl:this.dataSendCount++;if(this.dataSendCount>this.callLimit)return;break;case b.PingUrl:if(this.pingSendCount++,this.pingSendCount>this.callLimit)return}a=this.encode(DotmetricsJSON.stringify(a));a=encodeURIComponent(a);b=(new Date).getTime();d=d+"?v="+a+"&r="+b;a=document.createElement("script");
a.setAttribute("src",d);document.getElementsByTagName("head")[0].appendChild(a)};this.performAjaxPost=function(d,a){a=this.encode(DotmetricsJSON.stringify(a));a=encodeURIComponent(a);var b=(new Date).getTime();a="v="+a+"&r="+b;d+="?"+(new Date).getTime();window.XDomainRequest?(b=new XDomainRequest,b.open("POST",d),b.send(a)):(b=null,window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP")),b.open("POST",d,!0),b.withCredentials=!0,b.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded"),b.send(a))};this.performSendBeacon=function(d,a){this.sendMessageToExtension({target:"dotmetrics-extension",type:"beacon",url:d,data:a});a=this.encode(DotmetricsJSON.stringify(a));a=encodeURIComponent(a);var b=(new Date).getTime();a=new Blob(["v="+a+"&r="+b],{type:"application/x-www-form-urlencoded"});return navigator.sendBeacon(d,a)};this.addEventSimple=function(d,a,b){d.addEventListener?d.addEventListener(a,b,!1):d.attachEvent&&d.attachEvent("on"+a,b)};this.removeEventSimple=
function(d,a,b){d.removeEventListener?d.removeEventListener(a,b,!1):d.detachEvent&&d.detachEvent("on"+a,b)};this.isIE=function(){return-1!=navigator.appName.indexOf("Microsof")?!0:!1};this.saveInLocalStorage=function(d){if(this.lsAvailable())for(var a in d)d.hasOwnProperty(a)&&window.localStorage.setItem(a+"",d[a])};this.getFromLocalStorage=function(d){return this.lsAvailable()?window.localStorage.getItem(d+""):null};this.removeFromLocalStorage=function(d){return this.lsAvailable()?window.localStorage.removeItem(d+
""):null};this.CreateElement=function(d,a,b){if(null!=d){d=document.createElement(d);if(null!=a)for(x in a)"function"==typeof a[x]?this.addEventSimple(d,x,a[x]):(d.setAttribute(x,a[x]),"class"==x&&(d.className=a[x]));null!=b&&(a=document.createTextNode(b.toString()),d.appendChild(a));return d}return null!=b?document.createTextNode(b.toString()):null};this.clientInfo=null;this.createClientInfo=function(d){function a(){p=k.detect(b[f])?p+"1":p+"0";f++;f>=b.length?(c.FontString=p,r.clientInfo=c,d&&d()):
setTimeout(function(){a()},30)}if(this.clientInfo)d&&d();else{var b="cursive;monospace;serif;sans-serif;fantasy;Arial;Arial Black;Arial Narrow;Arial Rounded MT Bold;Bookman Old Style;Bradley Hand ITC;Century;Century Gothic;Comic Sans MS;Courier;Courier New;Georgia;Gentium;Impact;King;Lucida Console;Lalit;Modena;Monotype Corsiva;Papyrus;Tahoma;TeX;Times;Times New Roman;Trebuchet MS;Verdana;Verona;Bell MT;Berlin Sans FB;Corbel;Kalinga;Miriam Regular;Modern Standard;Segoe UI;Segoe Print;Inconsolata;Droid Sans Mono;Anonymous Pro;Liberation Mono;Terminus;Rosario;Roboto Slab;Oswald;Stalemate;Crimson Text;Gravitas One;Jura;League Gothic;Fjord;Proxima Nova;Trivia Grotesk;Pluto Sans;Museo Sans;Futura;Al Bayan;American Typewriter;Andale Mono;Apple Casual;Apple Chancery;Apple Garamond;Apple Gothic;Apple LiGothic;Apple LiSung;Apple Myungjo;Apple Symbols;.AquaKana;Arial Hebrew;Ayuthaya;Baghdad;Baskerville;Beijing;BiauKai;Big Caslon;Brush Script;Chalkboard;Chalkduster;Charcoal;Charcoal CY;Chicago;Cochin;Comic Sans;Cooper;Copperplate;Corsiva Hebrew;DecoType Naskh;Devanagari;Didot;Euphemia UCAS;Fang Song;Gadget;Geeza Pro;Geezah;Geneva;Geneva CY;Gill Sans;Gujarati;Gung Seoche;Gurmukhi;Hangangche;HeadlineA;Hei;Helvetica;Helvetica CY;Helvetica Neue;Herculanum;Hiragino Kaku Gothic Pro;Hiragino Kaku Gothic ProN;Hiragino Kaku Gothic Std;Hiragino Kaku Gothic StdN;Hiragino Maru Gothic Pro;Hiragino Maru Gothic ProN;Hiragino Mincho Pro;Hiragino Mincho ProN;Hoefler Text;Inai Mathi;Jung Gothic;Kai;Keyboard;Krungthep;KufiStandard GK;LastResort;LiHei Pro;LiSong Pro;Lucida Grande;Marker Felt;Menlo;Monaco;Monaco CY;Mshtakan;Nadeem;New Peninim;New York;NISC GB18030;Optima;Osaka;Palatino;PC Myungjo;Pilgiche;Plantagenet Cherokee;Raanana;Sand;Sathu;Seoul;Shin Myungjo Neue;Silom;Skia;Song;ST FangSong;ST Heiti;ST Kaiti;ST Song;Symbol;Tae Graphic;Taipei;Techno;Textile;Thonburi;Times CY;Zapf Chancery;Zapf Dingbats;Zapfino;Abadi MT Condensed Light;Aharoni;Aldhabi;Andalus;Angsana New;AngsanaUPC;Aparajita;Arabic Typesetting;Arial Nova;Batang;BatangChe;Book Antiqua;Browallia New;BrowalliaUPC;Calibri;Calibri Light;Calisto MT;Cambria;Cambria Math;Candara;Consolas;Constantia;Copperplate Gothic Bold;Copperplate Gothic Light;Cordia New;CordiaUPC;DaunPenh;David;Dengxian;DFKai-SB;DilleniaUPC;DokChampa;Dotum;DotumChe;Ebrima;Estrangelo Edessa;EucrosiaUPC;Euphemia;FangSong;Franklin Gothic Medium;FrankRuehl;FreesiaUPC;Gabriola;Gadugi;Gautami;Georgia Pro;Gill Sans Nova;Gisha;Gulim;GulimChe;Gungsuh;GungsuhChe;IrisUPC;Iskoola Pota;JasmineUPC;KaiTi;Kartika;Khmer UI;KodchiangUPC;Kokila;Lao UI;Latha;Leelawadee;Leelawadee UI;Levenim MT;LilyUPC;Lucida Handwriting Italic;Lucida Sans Unicode;Malgun Gothic;Mangal;Manny ITC;Marlett;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft JhengHei UI;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft Uighur;Microsoft YaHei;Microsoft YaHei UI;Microsoft Yi Baiti;MingLiU, PMingLiU;MingLiU-ExtB, PMingLiU-ExtB;MingLiU_HKSCS;MingLiU_HKSCS-ExtB;Miriam, Miriam Fixed;Mongolian Baiti;MoolBoran;MS Gothic, MS PGothic;MS Mincho, MS PMincho;MS UI Gothic;MV Boli;Myanmar Text;Narkisim;Neue Haas Grotesk Text Pro;News Gothic MT;Nirmala UI;NSimSun;Nyala;Palatino Linotype;Raavi;Rockwell Nova;Rod;Sakkal Majalla;Sanskrit Text;Segoe MDL2 Assets;Segoe Script;Segoe UI v5.00[3];Segoe UI v5.01[4];Segoe UI v5.27[5];Segoe UI v5.35;Segoe UI Emoji;Segoe UI Historic[6];Segoe UI Symbol;Shonar Bangla;Shruti;SimHei;SimKai;Simplified Arabic;SimSun;SimSun-ExtB;Sitka Banner;Sitka Display;Sitka Heading;Sitka Small;Sitka Subheading;Sitka Text;Sylfaen;Traditional Arabic;Tunga;Urdu Typesetting;Utsaah;Vani;Verdana Pro;Vijaya;Vrinda;Webdings;Westminster;Wingdings;Yu Gothic;Yu Gothic UI;Yu Mincho;Abyssinica SIL;Bitstream Charter;Century Schoolbook L;Courier 10 Pitch;DejaVu Sans;DejaVu Sans Condensed;DejaVu Sans Light;DejaVu Sans Mono;DejaVu Serif;DejaVu Serif Condensed;Dingbats;Droid Arabic Kufi;Droid Arabic Naskh;Droid Naskh Shift Alt;Droid Sans;Droid Sans Arabic;Droid Sans Armenian;Droid Sans Ethiopic;Droid Sans Fallback;Droid Sans Georgian;Droid Sans Hebrew;Droid Sans Japanese;Droid Serif;FreeMono;FreeSans;FreeSerif;Gargi;Garuda;KacstArt;KacstBook;KacstDecorative;KacstDigital;KacstFarsi;KacstLetter;KacstNaskh;KacstOffice;KacstOne;KacstPen;KacstPoster;KacstQurn;KacstScreen;KacstTitle;KacstTitleL;Kedage;Khmer OS;Khmer OS System;Kinnari;Laksaman;Liberation Sans;Liberation Sans Narrow;Liberation Serif;LKLUG;Lohit Bengali;Lohit Devanagari;Lohit Gujarati;Lohit Punjabi;Lohit Tamil;Loma;Mallige;Meera;mry_KacstQurn;Mukti Narrow;NanumBarunGothic;NanumGothic;NanumMyeongjo;Nimbus Mono L;Nimbus Roman No9 L;Nimbus Sans L;Norasi;OpenSymbol;Padauk;Padauk Book;Phetsarath OT;Pothana2000;Purisa;Rachana;Rekha;Saab;Sawasdee;STIX;STIXGeneral;TakaoPGothic;Tibetan Machine Uni;Tlwg Typist;Tlwg Typo;TlwgMono;TlwgTypewriter;Ubuntu;Ubuntu Condensed;Ubuntu Light;Ubuntu Mono;Umpush;URW Bookman L;URW Chancery L;URW Gothic L;URW Palladio L;utkal;Vemana2000;Waree;WenQuanYi Micro Hei;WenQuanYi Micro Hei Mono;Academy Engraved LET;Apple Color Emoji;AppleGothic;Bangla Sangam MN;Bodoni 72;Bodoni 72 Oldstyle;Bodoni 72 Smallcaps;Bodoni Ornaments;Bradley Hand;Chalkboard SE;Devanagari Sangam MN;Gujarati Sangam MN;Gurmukhi MN;Heiti SC;Heiti TC;Kailasa;Kannada Sangam MN;Malayalam Sangam MN;Marion;Noteworthy;Oriya Sangam MN;Party LET;Sinhala Sangam MN;Snell Roundhand;Tamil Sangam MN;Telugu Sangam MN".split(";"),
c={};c.AppCodeName=window.navigator.appCodeName;c.AppName=window.navigator.appName;c.Version=window.navigator.appVersion;c.Language=window.navigator.language;c.Platform=window.navigator.platform;c.Product=window.navigator.product;c.ProductSub=window.navigator.productSub;c.UserAgent=window.navigator.userAgent;c.Vendor=window.navigator.vendor;c.VendorSub=window.navigator.vendorSub;c.BuildId=window.navigator.buildID;c.OsCpu=window.navigator.oscpu;c.Screen={};c.Screen.AvailableWidth=window.screen.availWidth;
c.Screen.AvailableHeight=window.screen.availHeight;c.Screen.PixelDepth=window.screen.pixelDepth;c.Screen.ColorDepth=window.screen.colorDepth;var h=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;c.Screen.Width=Math.round(window.screen.width*h);c.Screen.Height=Math.round(window.screen.height*h);null==c.Screen.Width&&(c.Screen.Width=c.Screen.AvailableWidth);null==c.Screen.Height&&(c.Screen.Height=c.Screen.AvailableHeight);c.Plugins=[];if(window.ActiveXObject){h=/[0-9]+/;
var g={flash:"ShockwaveFlash.ShockwaveFlash",pdf:"AcroPDF.PDF",silverlight:"AgControl.AgControl",quicktime:"QuickTime.QuickTime"};for(l in g){var e=this.msieDetect(g[l]);e&&(e=(e=h.exec(e))&&e[0]||"",e={},e.Name=g[l],e.FileName="",c.Plugins.push(e))}}else for(var f=0;f<window.navigator.plugins.length;f++){var l=window.navigator.plugins[f];h={};h.Name=l.name;h.FileName=l.filename;c.Plugins.push(h)}c.MimeTypes=[];for(f=0;l=window.navigator.mimeTypes[f];f++)h={},h.Type=l.type,h.Suffixes=l.suffixes,c.MimeTypes.push(h);
c.Canvas=this.CreateCanvasFP();var p="",k=new function(){var a=["monospace","sans-serif","serif"],c=document.getElementsByTagName("body")[0],b=document.createElement("span");b.style.fontSize="72px";b.innerHTML="mmmmmmmmmmlli";var d={},h={},e;for(e in a)b.style.fontFamily=a[e],c.appendChild(b),d[a[e]]=b.offsetWidth,h[a[e]]=b.offsetHeight,c.removeChild(b);this.detect=function(e){var g=!1,f;for(f in a){b.style.fontFamily=e+","+a[f];c.appendChild(b);var q=b.offsetWidth!=d[a[f]]||b.offsetHeight!=h[a[f]];
c.removeChild(b);g=g||q}return g}},r=this;f=0;setTimeout(function(){a()},20)}};this.msieDetect=function(d){try{var a=new ActiveXObject(d);try{return a.GetVariable("$version")}catch(c){try{return a.GetVersions()}catch(h){try{var b;for(d=1;9>d;d++)a.isVersionSupported(d+".0")&&(b=d);return b||!0}catch(g){return!0}}}}catch(c){return!1}};this.CreateCanvasFP=function(){var d=document.createElement("canvas");if(d.getContext&&d.getContext("2d")){d.width=250;d.height=250;document.getElementById("fingerprint-output");
for(var a=d.getContext("2d"),b=0;b<d.width/2;b++)a.moveTo(2*b,0),a.lineTo(4*b,d.height),a.strokeStyle="rgba(0, 0, 0, 0.1)",a.stroke();a.font="40px 'Arial'";for(b=0;3>b;b++)a.fillStyle="#41b4e7",a.fillText("Dotmetrics",10,50*b+75),a.fillStyle="rgba(255, 255, 255, 0.7)",a.fillText("Dotmetrics",20,50*b+75);d=d.toDataURL("image/jpeg",1);return this.SHA1(d).toString()}return null};this.CreateElement=function(d,a,b){if(null!=d){d=document.createElement(d);if(null!=a)for(x in a)"function"==typeof a[x]?this.addEventSimple(d,
x,a[x]):(d.setAttribute(x,a[x]),"class"==x&&this.isIE()&&(d.className=a[x]));null!=b&&(a=document.createTextNode(b.toString()),d.appendChild(a));return d}return null!=b?document.createTextNode(b.toString()):null};this.encode=function(d){var a="",b=0;for(d=this.utf8Encode(d);b<d.length;){var c=d.charCodeAt(b++);var h=d.charCodeAt(b++);var g=d.charCodeAt(b++);var e=c>>2;c=(c&3)<<4|h>>4;var f=(h&15)<<2|g>>6;var l=g&63;isNaN(h)?f=l=64:isNaN(g)&&(l=64);a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)}return a};this.utf8Encode=function(d){d=d.replace(/\r\n/g,"\n");for(var a="",b=0;b<d.length;b++){var c=d.charCodeAt(b);128>c?a+=String.fromCharCode(c):(127<c&&2048>c?a+=String.fromCharCode(c>>6|192):(a+=String.fromCharCode(c>>12|224),a+=String.fromCharCode(c>>6&63|128)),
a+=String.fromCharCode(c&63|128))}return a};this.SHA1=function(d){function a(a,b){return a<<b|a>>>32-b}function b(a){var b="",c;for(c=7;0<=c;c--){var d=a>>>4*c&15;b+=d.toString(16)}return b}var c,h=Array(80),g=1732584193,e=4023233417,f=2562383102,l=271733878,p=3285377520;d=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>
6&63|128)),b+=String.fromCharCode(d&63|128))}return b}(d);var k=d.length;var r=[];for(c=0;c<k-3;c+=4){var m=d.charCodeAt(c)<<24|d.charCodeAt(c+1)<<16|d.charCodeAt(c+2)<<8|d.charCodeAt(c+3);r.push(m)}switch(k%4){case 0:c=2147483648;break;case 1:c=d.charCodeAt(k-1)<<24|8388608;break;case 2:c=d.charCodeAt(k-2)<<24|d.charCodeAt(k-1)<<16|32768;break;case 3:c=d.charCodeAt(k-3)<<24|d.charCodeAt(k-2)<<16|d.charCodeAt(k-1)<<8|128}for(r.push(c);14!=r.length%16;)r.push(0);r.push(k>>>29);r.push(k<<3&4294967295);
for(d=0;d<r.length;d+=16){for(c=0;16>c;c++)h[c]=r[d+c];for(c=16;79>=c;c++)h[c]=a(h[c-3]^h[c-8]^h[c-14]^h[c-16],1);m=g;k=e;var q=f;var n=l;var u=p;for(c=0;19>=c;c++){var t=a(m,5)+(k&q|~k&n)+u+h[c]+1518500249&4294967295;u=n;n=q;q=a(k,30);k=m;m=t}for(c=20;39>=c;c++)t=a(m,5)+(k^q^n)+u+h[c]+1859775393&4294967295,u=n,n=q,q=a(k,30),k=m,m=t;for(c=40;59>=c;c++)t=a(m,5)+(k&q|k&n|q&n)+u+h[c]+2400959708&4294967295,u=n,n=q,q=a(k,30),k=m,m=t;for(c=60;79>=c;c++)t=a(m,5)+(k^q^n)+u+h[c]+3395469782&4294967295,u=n,
n=q,q=a(k,30),k=m,m=t;g=g+m&4294967295;e=e+k&4294967295;f=f+q&4294967295;l=l+n&4294967295;p=p+u&4294967295}t=b(g)+b(e)+b(f)+b(l)+b(p);return t.toLowerCase()};this.sendMessageToExtension=function(d){window.sendMessageToDotmetricsExtension&&window.sendMessageToDotmetricsExtension(d)};this.postMessage=function(d){try{window.postMessage(d,window.location.origin)}catch(a){}}}var v=new function(){this.SettingsObject=window.DotMetricsSettings;this.Core=new y;this.EnterPageEventData=null;this.TimeOnPage=
0;this.LastSentTimeOnPage=-1;this.TimeBuffer=0;this.TimeTreshold=18E5;this.surveyLink=this.LoadTimeStamp="";this.DeviceGuidId=this.UserId=this.DeviceId=null;this.deviceInfoSent=!1;this.postIndex=0;this.surveyDone=this.Done=!1;this.ajaxTimer=null;this.panel=!1;this.panelHouseholdId=this.panelUserId=null;this.videos={};this.foundVideoPlayers=[];this.SaveTimeOnPageInterval=1E4;this.MaxTimeOnPageItemsInCookie=8;this.fbInstantArticle=!1;this.lastInteraction=this.saveTimeOnPageIntervalFunctionId=this.timeBufferIntervalInstanceId=
null;this.Start=function(){var a=this;0<=navigator.userAgent.indexOf("FBIA")&&(a.fbInstantArticle=!0);document.addEventListener("visibilitychange",function(){if("hidden"===document.visibilityState){a.stopIntervalFunctions();a.emptyTimeBuffer();var b=a.SendTimeOnPageBeacon();a.SaveTimeOnPage(b)}else"visible"===document.visibilityState&&a.startIntervalFunctions()});a.startIntervalFunctions();this.initPanelElements();this.initInteractionEvents();this.listenForExtensionMessages();var b=this.createStartData();
a.Core.sendData(this.SettingsObject.DataUrl,b);if(window.dm)this.onAjaxDataUpdate();1==this.SettingsObject.VideoTrackingEnabled&&this.trackVideos()};this.listenForExtensionMessages=function(){var a=this;window.addEventListener("message",function(b){b.data.source&&"dotmetrics-extension"==b.data.source&&b.data.type&&a.handleExtensionRequest(b.data.type)})};this.handleExtensionRequest=function(a){switch(a){case "timeOnPage":a=this.createCurrentTimeOnPageObject();var b=this.getTimeOnPageDataTemplate();
b.ep.push(a);this.Core.sendMessageToExtension({target:"dotmetrics-extension",type:"timeOnPage",data:b});break;case "getEnterPageData":this.EnterPageEventData&&this.Core.postMessage({target:"dotmetrics-plugin",type:"enterPageData",data:this.EnterPageEventData})}};this.createStartData=function(){var a=(new Date).getTimezoneOffset();a={id:this.SettingsObject.SiteSectionId,fl:!0,dom:window.location.hostname,lso:null,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,
tzOffset:a};this.panel&&(a.hhid=this.panelHouseholdId,a.uid=this.panelUserId);var b="DM_SitId"+this.SettingsObject.SiteId,c="DM_SitIdT"+this.SettingsObject.SiteId,d=b+"SecId"+this.SettingsObject.SiteSectionId,g=b+"SecIdT"+this.SettingsObject.SiteSectionId,e=this.Core.getFromLocalStorage("DotmetricsSiteData");e=e?DotmetricsJSON.parse(e):{};var f=(new Date).getTime()-18E5;for(l in e)e[l]<f&&delete e[l];this.Core.hasCookie(b)&&e.hasOwnProperty(c)?a.oss=!1:(this.Core.setCookie(b,"1"),a.oss=!0);this.Core.hasCookie(d)&&
e.hasOwnProperty(g)?a.oses=!1:(this.Core.setCookie(d,"1"),a.oses=!0);var l=(new Date).getTime();e[c]=l;e[g]=l;c={DotmetricsSiteData:JSON.stringify(e)};this.Core.saveInLocalStorage(c);return a};this.processActions=function(a){var b=this,c=(new Date).getTimezoneOffset();c={id:this.SettingsObject.SiteSectionId,fl:!1,dom:window.location.hostname,lso:null,ds:null,dsl:null,dh:null,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,tzOffset:c};this.panel&&(c.hhid=this.panelHouseholdId,
c.uid=this.panelUserId);var d=!1;if(a.SendDeviceInfo||a.Ping){var g={deviceInfo:!1,pings:0,exitPageData:!1};a.Ping&&0<a.Ping&&0==this.deviceInfoSent&&(g.pings=a.Ping);a.SendDeviceInfo&&0==this.deviceInfoSent&&(this.deviceInfoSent=g.deviceInfo=!0);this.submitData(g)}if(a.Survey&&a.Survey.SurveyUrl)if(this.Survey=a.Survey,this.Survey.Mobile){var e=this;this.anchor=this.Core.CreateElement("a",{href:a.Survey.SurveyUrl,style:"position:fixed; width:100%; height:100%; top:0; left:0; background:#f00; opacity:0;z-index:99999",
target:"_blank",id:"DotMetricsPopupLink"},null);document.body.appendChild(this.anchor);this.Core.addEventSimple(this.anchor,"click",function(a){a.preventDefault();var b=e.anchor.getAttribute("href");document.body.removeChild(e.anchor);e.surveyDone||(e.surveyDone=!0,setTimeout(function(){window.open(b,"_blank")},20))})}else{var f=function(){document.body.addEventListener?document.body.removeEventListener("click",f):document.body.detachEvent("onclick",f);b.showSurvey()};document.body.addEventListener?
document.body.addEventListener("click",f,!1):document.body.attachEvent("onclick",f)}if(a.SendDeviceHash)if(this.Core.clientInfo)d=DotmetricsJSON.stringify(this.Core.clientInfo),d=this.Core.SHA1(d),c.dh=d.toString(),d=!0;else{this.Core.createClientInfo(function(){b.processActions(a)});return}a.PersistDeviceAndUser&&a.DeviceId&&a.UserId&&a.DeviceGuidId&&this.Core.saveInLocalStorage({DotMetricsDeviceId:a.DeviceId,DotMetricsUserId:a.UserId,DotMetricsDeviceGuidId:a.DeviceGuidId});if(a.SendLSO){d=this.Core.getFromLocalStorage("DotMetricsUserId");
g=this.Core.getFromLocalStorage("DotMetricsDeviceId");var l=this.Core.getFromLocalStorage("DotMetricsDeviceGuidId");c.lso=d&&g&&l?{d:g,u:d,dg:l}:{d:"",u:"00000000-0000-0000-0000-000000000000",dg:"00000000-0000-0000-0000-000000000000"};d=!0}d&&b.Core.sendData(this.SettingsObject.DataUrl,c)};this._timeData=[];this._requestedPingsNum=this._currentRequestNum=0;this._onPingMeasurmentsDone=null;this._pingStartTime=0;this.measurePingTimes=function(a,b){this._timeData=[];this._currentRequestNum=0;this._requestedPingsNum=
a;this._onPingMeasurmentsDone=b;this.makePingRequest()};this.makePingRequest=function(){this._pingStartTime=(new Date).getTime();var a=0==this._timeData.length?{ctd:0,cl:0}:this._timeData[this._timeData.length-1];a.ct=this._pingStartTime;this.Core.sendData(this.SettingsObject.PingUrl,a)};this.HandlePing=function(a){var b=(new Date).getTime(),c=(b-this._pingStartTime)/2;this._timeData.push({ctd:a.s-b-Math.abs(c),cl:c});this._currentRequestNum++;if(this._currentRequestNum<this._requestedPingsNum)this.makePingRequest();
else{for(c=b=a=0;c<this._timeData.length;c++)a+=this._timeData[c].ctd,b+=this._timeData[c].cl;a=Math.round(a/this._timeData.length);b=Math.round(b/this._timeData.length);a={DeviceSync:a,DeviceSyncLag:b};this._onPingMeasurmentsDone(a)}};this.showSurvey=function(){this.surveyDone||(this.surveyDone=!0,window.open(this.Survey.SurveyUrl,"","width="+this.Survey.WindowWidth+",height="+this.Survey.WindowHeight+",scrollbars=1").focus())};this.startIntervalFunctions=function(){var a=this;null==this.timeBufferIntervalInstanceId&&
(this.timeBufferIntervalInstanceId=setInterval(function(){void 0!=document.visibilityState?"visible"==document.visibilityState&&a.TimeBuffer++:a.TimeBuffer++;a.fbInstantArticle&&a.emptyTimeBuffer()},1E3));null==this.saveTimeOnPageIntervalInstanceId&&(this.saveTimeOnPageIntervalFunctionId=setInterval(function(){a.SaveTimeOnPage()},a.SaveTimeOnPageInterval))};this.stopIntervalFunctions=function(){this.timeBufferIntervalInstanceId&&(clearInterval(this.timeBufferIntervalInstanceId),this.timeBufferIntervalInstanceId=
null);this.saveTimeOnPageIntervalFunctionId&&(clearInterval(this.saveTimeOnPageIntervalFunctionId),this.saveTimeOnPageIntervalFunctionId=null)};this.emptyTimeBuffer=function(){if((new Date).getTime()-this.lastInteraction.getTime()<=this.TimeTreshold||this.fbInstantArticle)this.TimeOnPage+=this.TimeBuffer;this.TimeBuffer=0;this.lastInteraction=new Date};this.SendTimeOnPageBeacon=function(){if(this.LastSentTimeOnPage==this.TimeOnPage)return!0;if(navigator.sendBeacon&&this.EnterPageEventData){var a=
this.createCurrentTimeOnPageObject(),b=this.getTimeOnPageDataTemplate();b.ep.push(a);this.LastSentTimeOnPage=this.TimeOnPage;return this.Core.performSendBeacon(this.SettingsObject.BeaconUrl,b)}return!1};this.createCurrentTimeOnPageObject=function(){return{cd:this.EnterPageEventData.CreationDate,eid:this.EnterPageEventData.EventId,id:this.EnterPageEventData.SiteSectionId,sop:this.TimeOnPage,vl:this.getVideoData(),url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID}};
this.getTimeOnPageDataTemplate=function(){var a=(new Date).getTimezoneOffset();a={id:this.SettingsObject.SiteSectionId,cd:{d:this.DeviceId,u:this.UserId,dg:this.DeviceGuidId},ep:[],tzOffset:a};this.panel&&(a.hhid=this.panelHouseholdId,a.uid=this.panelUserId);return a};this.SaveTimeOnPage=function(a){if(0!=this.Core.lsAvailable()&&null!=this.EnterPageEventData){for(var b=this.getTimeOnPageData(),c=0;c<b.length;c++)if(b[c].eid==this.EnterPageEventData.EventId){b.splice(c,1);break}a||(a=this.createCurrentTimeOnPageObject(),
b.push(a));a={};a[this.SettingsObject.TimeOnPage]=DotmetricsJSON.stringify(b);this.Core.saveInLocalStorage(a)}};this.processTimeOnPageData=function(){if(0==this.Core.lsAvailable())return null;for(var a=[],b=this.getTimeOnPageData(),c=new Date,d=0;d<b.length;d++)try{var g=b[d],e=new Date(g.cd);864E5>c.getTime()-e.getTime()&&a.push(g)}catch(f){}0==a.length&&(a=null);this.Core.removeFromLocalStorage(this.SettingsObject.TimeOnPage);return a};this.getTimeOnPageData=function(){var a=this.Core.getFromLocalStorage(this.SettingsObject.TimeOnPage),
b=[];if(null!=a&&0<a.length)try{b=DotmetricsJSON.parse(a)}catch(c){b=JSON.parse(a)}return b};this.initInteractionEvents=function(){this.lastInteraction=new Date;var a=this;this.Core.addEventSimple(document,"mousemove",function(){a.emptyTimeBuffer()});this.Core.addEventSimple(document,"wheel",function(){a.emptyTimeBuffer()});this.Core.addEventSimple(document,"touchend",function(){a.emptyTimeBuffer()})};this.initPanelElements=function(){if(document.getElementById("DotmetricsPanelUserId")&&document.getElementById("DotmetricsPanelHouseholdId")){this.panel=
!0;this.panelUserId=document.getElementById("DotmetricsPanelUserId").value;this.panelHouseholdId=document.getElementById("DotmetricsPanelHouseholdId").value;var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("id","DotmetricsScriptLoaded");a.setAttribute("value","true");document.getElementsByTagName("head")[0].appendChild(a)}};this.CreateIframe=function(){this.iFrameHolderDiv=this.Core.CreateElement("div",{id:"DotMetricsPF",style:"display:none;width:0px;height:0px;position:absolute; left:-2000px;"},
null);var a="dotmetricsframe"+this.postIndex;this.postIndex++;this.iFrameHolderDiv.style.display="none";try{this.iframe=document.createElement('<iframe name="'+a+'" style:"display:none;width:0px;height:0px;">')}catch(b){this.iframe=this.Core.CreateElement("iframe",{name:a,id:a,style:"display:none;width:0px;height:0px;"},null)}this.iframe.id=a;this.form=this.Core.CreateElement("form",{action:this.SettingsObject.PostUrl,method:"post",target:a,id:"DotMetricsForm"},null);this.formInput=this.Core.CreateElement("input",
{type:"text",name:"v"},null);document.body.appendChild(this.iFrameHolderDiv);this.iFrameHolderDiv.appendChild(this.iframe);this.iFrameHolderDiv.appendChild(this.form);this.form.appendChild(this.formInput);document.getElementById("DotMetricsForm").target=a};this.submitData=function(a){function b(){c.CreateIframe();c.formInput.value=DotmetricsJSON.stringify(g);c.form.submit();var a=c.iFrameHolderDiv;setTimeout(function(){document.body.removeChild(a)},5E3)}var c=this;this.Core.formPostCount++;if(!(this.Core.formPostCount>
this.Core.callLimit)){var d=(new Date).getTimezoneOffset(),g={id:this.SettingsObject.SiteSectionId,cd:{d:this.DeviceId,u:this.UserId,dg:this.DeviceGuidId},di:null,ds:0,dsl:0,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,tzOffset:d};this.panel&&(g.hhid=this.panelHouseholdId,g.uid=this.panelUserId);if(a.deviceInfo)if(this.Core.clientInfo)g.di=this.Core.clientInfo;else{this.Core.createClientInfo(function(){c.submitData(a)});return}0<a.pings?this.measurePingTimes(a.pings,
function(a){g.ds=a.DeviceSync;g.dsl=a.DeviceSyncLag;b()}):b()}};this.HandleJsonp=function(a){var b=this;b.Core.sendMessageToExtension({target:"dotmetrics-extension",type:"jsonpResponse",data:a,pvid:this.SettingsObject.PVID});this.UserId=a.UserId;this.DeviceId=a.DeviceId;this.DeviceGuidId=a.DeviceGuidId;window.DotMetricsObj.DeviceId=this.DeviceId;window.DotMetricsObj.UserId=this.UserId;this.deviceInfoSent&&(a.SendDeviceInfo=!1,a.Ping=0);if(this.firstLoadDone)this.processActions(a);else{this.firstLoadDone=
!0;this.EnterPageEventData=a.EnterPageEventData;window.DotMetricsObj.firstLoadDone=!0;window.DotMetricsObj.EnterPageEventData=a.EnterPageEventData;var c={deviceInfo:!1,pings:0};1==a.SendDeviceInfo&&0==this.deviceInfoSent&&(c.deviceInfo=!0,a.SendDeviceInfo=!1,this.deviceInfoSent=!0);a.Ping&&0<a.Ping&&(c.pings=a.Ping,a.Ping=!1);setTimeout(function(){(c.deviceInfo||c.pings)&&b.submitData(c);var d=b.processTimeOnPageData();b.Core.setCookie(b.SettingsObject.TimeOnPage,null,0);if(d){var g=b.getTimeOnPageDataTemplate();
g.ep=d;b.Core.performAjaxPost(b.SettingsObject.BeaconUrl,g)}b.processActions(a)},1E3*Math.random()+500)}};this.onAjaxDataUpdate=function(){var a=window.dm,b=this;null==this.ajaxTimer&&0<a.AjaxData.length&&(this.ajaxTimer=setTimeout(function(){b.cloneAjaxDataForStressTestScript(a.AjaxData);var c=b.prepareAjaxData(a.AjaxData);a.AjaxData.length=0;b.ajaxTimer=null;b.Core.performAjaxPost(b.SettingsObject.AjaxEventUrl,c)},this.SettingsObject.AjaxEventTimeout))};this.cloneAjaxDataForStressTestScript=function(a){try{if("undefined"!=
typeof window.DotMetricsObjStress){var b=JSON.parse(JSON.stringify(a));"undefined"==typeof window.dmStress&&(window.dmStress={AjaxData:[]});for(a=0;a<b.length;a++)window.dmStress.AjaxData.push(b[a]);window.DotMetricsObjStress.onAjaxDataUpdate()}}catch(c){}};this.prepareAjaxData=function(a){var b=(new Date).getTimezoneOffset(),c={siteSectionId:this.SettingsObject.SiteSectionId,pvid:this.SettingsObject.PVID,domain:window.location.hostname,events:[],tzOffset:b};this.panel&&(c.hhid=this.panelHouseholdId,
c.uid=this.panelUserId);var d=this;a.forEach(function(a){var b={};b.eventType=a.et?a.et:"pageview";b.eventData=a.d?a.d:null;b.eventSiteSectionId=a.ssid?a.ssid:d.SettingsObject.SiteSectionId;isNaN(b.eventSiteSectionId)&&(b.eventTag=b.eventSiteSectionId,delete b.eventSiteSectionId);b.url=a.url?a.url:window.location.href;c.events.push(b)});return c};this.trackVideos=function(){var a=this;(new w(function(b,c,d){switch(b){case "flowPlayer":a.trackFP(d,b,c);break;case "jwPlayer":a.trackJW(d,b,c);break;
case "videojs":a.trackVideoJS(d,b,c)}})).init()};var d=!1;this.sendVideoError=function(a,b,c){d||(d=!0,this.Core.performAjaxPost(this.SettingsObject.ErrorEventUrl,{type:"video",details:{player:a,playerVersion:b},error:c,sectionId:this.SettingsObject.SiteSectionId,pageUrl:window.location.href}))};this.trackFP=function(a,b,c){function d(){var b="";try{b=a.opts.title}catch(n){}return a.currentSrc+"_"+b}function g(){var b="";try{b=a.opts.title}catch(t){}var c=Math.max(0,a.duration),h=d();f.videos[h]=
{vid:a.currentSrc,w:a.videoWidth,h:a.videoHeight,vdur:c,tw:0,ls:a.opts.live,t:b};p=l=null}function e(d){a.off("loadedmetadata",k);a.off("seeked",r);a.off("timeupdate",m);f.sendVideoError(b,c,d)}var f=this,l=null,p=null,k=function(a){try{g()}catch(n){e(n)}},r=function(b){try{l=a.currentTime,p=(new Date).getTime()}catch(n){e(n)}},m=function(b){try{if(l&&0==a.playerState["is-seeking"]){var c=a.currentTime-l,h=.001*((new Date).getTime()-p);if(0<c){if(1<c)return;var m=d();f.videos[m]?(a.currentTime!=l&&
0<h&&1>h&&(f.videos[m].tw+=h),f.videos[m].vdur<a.duration&&(f.videos[m].vdur=a.duration)):g()}}l=a.currentTime;p=(new Date).getTime()}catch(z){e(z)}};a.on("loadedmetadata",k);a.on("seeked",r);a.on("timeupdate",m)};this.trackJW=function(a,b,c){function d(){var b=a.getPlaylistItem();if("undefined"!=typeof b){var c=b.file+"_"+b.title;if(!e.videos[c]){var d=a.getConfig();e.videos[c]={vid:b.file,w:a.getWidth(),h:a.getHeight(),vdur:a.getDuration(),tw:0,ls:d&&"Live"==d.streamType,t:b.title};0>e.videos[c].vdur&&
(e.videos[c].vdur=0)}f=a.getPosition();l=(new Date).getTime()}}function g(d){a.off("play",p);a.off("seek",k);a.off("time",r);e.sendVideoError(b,c,d)}var e=this,f=null,l=null,p=function(a){try{d()}catch(q){g(q)}},k=function(a){try{f=a.offset}catch(q){g(q)}},r=function(b){try{if(f){var c=.001*((new Date).getTime()-l),h=a.getPlaylistItem();if("undefined"==typeof h)return;var k=h.file+"_"+h.title;"undefined"==typeof e.videos[k]&&d();b.position!=f&&0<c&&1>c&&(e.videos[k].tw+=c);e.videos[k].h||(e.videos[k].h=
a.getHeight());e.videos[k].w||(e.videos[k].w=a.getWidth());if(!e.videos[k].vdur||e.videos[k].vdur<a.getDuration())e.videos[k].vdur=a.getDuration()}f=b.position;l=(new Date).getTime()}catch(t){g(t)}};a.on("play",p);a.on("seek",k);a.on("time",r)};this.trackVideoJS=function(a,b,c){function d(){var b=a.mediainfo?a.mediainfo.name:"";return a.currentSrc()+"_"+b}function g(){var b=a.currentSrc();if(""!=b){var c=d();f.videos[c]||(f.videos[c]={vid:b,w:"function"==typeof a.videoWidth?a.videoWidth():a.width(),
h:"function"==typeof a.videoHeight?a.videoHeight():a.height(),vdur:a.duration(),tw:0,ls:!1,t:a.mediainfo?a.mediainfo.name:""},0>f.videos[c].vdur&&(f.videos[c].vdur=0),p=l=null)}}function e(d){a.off("loadedmetadata",k);a.off("timeupdate",r);f.sendVideoError(b,c,d)}var f=this,l=null,p=null,k=function(){try{g()}catch(m){e(m)}},r=function(){try{if(l&&0==a.seeking()&&("function"==typeof a.scrubbing?0==a.scrubbing():1)){var b=.001*((new Date).getTime()-p);if(""==a.currentSrc())return;var c=d();if("undefined"==
typeof f.videos[c]){g();return}try{f.videos[c].ls=f.videos[c].ls||"undefined"!=a.liveTracker&&a.liveTracker.isLive&&a.liveTracker.isLive()}catch(n){}f.videos[c].vdur<a.duration()&&(f.videos[c].vdur=a.duration());a.currentTime()!=l&&0<b&&1>b&&(f.videos[c].tw+=b)}l=a.currentTime();p=(new Date).getTime()}catch(n){e(n)}};a.on("loadedmetadata",k);a.on("timeupdate",r)};this.getVideoData=function(){var a=this.videos,b=[],c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];!d.vid||""==d.vid||0<=d.vid.indexOf("data:video")||
(d.w=Math.round(d.w),d.h=Math.round(d.h),d.w||(d.w=0),d.h||(d.h=0),d.vdur&&isFinite(d.vdur)?(d.vdur=Math.round(d.vdur),0>d.vdur&&(d.vdur=0)):d.vdur=0,0<d.tw&&1>d.tw&&(d.tw=1),d.tw=Math.round(d.tw),0<d.tw&&b.push(d))}return b}};window.DotMetricsObj={onAjaxDataUpdate:function(){v.onAjaxDataUpdate()},HandleJsonp:function(d){v.HandleJsonp(d)},HandlePing:function(d){v.HandlePing(d)}};top.location==self.location&&setTimeout(function(){v.Start()},100)})(window);
